<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title | default("Deployment Output") }}</title>

  <!-- Simple, clean CSS (no external deps) -->
  <style>
    :root{
      --bg:#0f1724;    /* deep navy */
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#6ee7b7; /* mint accent */
      --danger:#ff7b7b;
      --glass: rgba(255,255,255,0.04);
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: linear-gradient(180deg,#071024 0%, #071026 60%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
    }

    .container{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
      align-items:start;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      box-shadow: 0 6px 20px rgba(3,7,18,0.6);
      border: 1px solid rgba(255,255,255,0.03);
    }

    header.site-header{
      max-width:1100px;
      margin:0 auto 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .title{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:44px; height:44px; border-radius:10px;
      background:linear-gradient(135deg,var(--accent), #4dd0e1);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;color:#04202a;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }
    h1{ font-size:20px; margin:0 0 2px }
    .subtitle{ color:var(--muted); font-size:13px }

    .meta { text-align:right; color:var(--muted); font-size:13px; }

    /* left column content */
    .summary { margin-bottom:12px; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .pill{
      background:var(--glass);
      color:var(--muted);
      padding:6px 10px;
      border-radius:999px;
      font-size:13px;
      border:1px solid rgba(255,255,255,0.02);
    }
    .status {
      padding:8px 12px;
      border-radius:999px;
      font-weight:700;
      font-size:13px;
      display:inline-block;
    }
    .status.success{ background: rgba(110,231,183,0.12); color:var(--accent); border:1px solid rgba(110,231,183,0.12) }
    .status.warn{ background: rgba(255,205,92,0.08); color:#ffd88a }
    .status.fail{ background: rgba(255,123,123,0.08); color:var(--danger) }

    /* logs */
    pre.log{
      background: #020617;
      padding:14px;
      border-radius:10px;
      max-height:480px;
      overflow:auto;
      color:#dbeafe;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      line-height:1.45;
      border:1px solid rgba(255,255,255,0.02);
    }

    /* right column */
    .right h3{ margin:0 0 8px }
    .kv{ display:flex; justify-content:space-between; gap:8px; padding:8px 10px; border-radius:8px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); margin-bottom:8px; font-size:14px }
    .kv .k{ color:var(--muted); } .kv .v{ font-weight:700; text-align:right; }

    /* log line highlights */
    .ok{ color: #a7f3d0 }
    .warn{ color: #ffd88a }
    .err{ color: #ff9b9b }

    footer{ color:var(--muted); font-size:12px; margin-top:18px; text-align:center }
    @media (max-width:980px){
      .container{ grid-template-columns: 1fr; }
      .meta{ text-align:left; margin-top:6px }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="title">
      <div class="logo">AL</div>
      <div>
        <h1>{{ heading | default("Alpha — Deployment Output") }}</h1>
        <div class="subtitle">{{ subheading | default("CI → Build → Push → GitOps → Deploy") }}</div>
      </div>
    </div>
    <div class="meta">
      <div>Build: <strong>{{ build_number | default("—") }}</strong></div>
      <div>{{ timestamp | default("{{ now }}") }}</div>
    </div>
  </header>

  <main class="container" role="main">
    <!-- LEFT: summary + logs -->
    <section class="card">
      <div class="summary">
        <div class="pill">Repo: <strong>{{ repo | default("Iam-mithran/LWM-SourceCodeRepo") }}</strong></div>
        <div class="pill">Image: <strong>{{ image | default("992382.../lwm-alpha:latest") }}</strong></div>
        <div class="pill">Tag: <strong>{{ image_tag | default("latest") }}</strong></div>
        <div style="margin-left:auto">
          <span class="status {{ status_class | default('success') }}">{{ status_text | default("SUCCESS") }}</span>
        </div>
      </div>

      <h3 style="margin:8px 0 10px">Summary</h3>
      <p style="color:var(--muted); margin-top:0">
        {{ summary | default("The pipeline completed. See logs below for details. Click 'Copy' to copy output to clipboard.") }}
      </p>

      <h3 style="margin-top:14px">Build & Deploy Logs</h3>
      <pre class="log" id="logBlock" aria-live="polite">
{% for line in logs %}
<span class="{% if 'error' in line|lower or 'failed' in line|lower %}err{% elif 'warning' in line|lower or 'warn' in line|lower %}warn{% elif 'success' in line|lower or 'pushed' in line|lower or 'synced' in line|lower %}ok{% endif %}">{{ line }}</span>
{% endfor %}
      </pre>

      <div style="display:flex; gap:8px; margin-top:10px;">
        <button onclick="copyLogs()" style="background:var(--accent);border:none;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer">Copy Logs</button>
        <a href="{{ external_link or '#' }}" target="_blank" style="text-decoration:none">
          <button style="background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:10px;cursor:pointer">Open in Console</button>
        </a>
      </div>
    </section>

    <!-- RIGHT: metadata & actions -->
    <aside class="card right" aria-label="metadata">
      <h3>Deployment Info</h3>

      <div class="kv"><div class="k">Environment</div><div class="v">{{ env | default("dev") }}</div></div>
      <div class="kv"><div class="k">Replicas</div><div class="v">{{ replicas | default(3) }}</div></div>
      <div class="kv"><div class="k">Cluster</div><div class="v">{{ cluster | default("eks-prod") }}</div></div>
      <div class="kv"><div class="k">Namespace</div><div class="v">{{ namespace | default("default") }}</div></div>
      <div class="kv"><div class="k">Commit</div><div class="v">{{ commit | default("—") }}</div></div>
      <div style="height:12px"></div>

      <h3 style="margin-top:8px">Quick Actions</h3>
      <div style="display:flex;flex-direction:column;gap:8px">
        <form method="post" action="{{ action_retry or '#' }}">
          <button type="submit" style="width:100%;padding:10px;border-radius:8px;border:none;font-weight:700;cursor:pointer">Retry Deploy</button>
        </form>
        <a href="{{ argocd_url or '#' }}" target="_blank" style="text-decoration:none">
          <button style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;cursor:pointer">Open Argo CD</button>
        </a>
      </div>

      <footer>
        <div>Rendered by <strong>Alpha CI</strong></div>
        <div style="margin-top:6px">Status: <span style="font-weight:700">{{ status_text | default("SUCCESS") }}</span></div>
      </footer>
    </aside>
  </main>

  <script>
    function copyLogs(){
      const text = document.getElementById('logBlock').innerText;
      navigator.clipboard?.writeText(text).then(()=> {
        alert('Logs copied to clipboard');
      }, ()=> {
        alert('Failed to copy. Select and copy manually.');
      });
    }
    // auto-scroll to bottom
    const lb = document.getElementById('logBlock');
    if(lb) lb.scrollTop = lb.scrollHeight;
  </script>
</body>
</html>
